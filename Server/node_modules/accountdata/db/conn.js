var connection = null;
var MongoClient = require('mongodb').MongoClient;

exports.withDb = function(callback) {
    if (connection) return connection;
    else {
        MongoClient.connect('mongodb://127.0.0.1:27017/cubes', function (e, c) {
            connection = c;
            callback(e, c);
        });
    }
}

exports.initializeDb = function(callback) {
    conn.withDb(function (err1, db) {
        if (err1) {
            callback(err1);
            return;
        }
        var accounts = db.collection('accounts');
        accounts.ensureIndex({'username': 1}, {'unique': true});
        callback(null);
    });
}
